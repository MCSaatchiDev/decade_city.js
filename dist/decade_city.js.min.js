/*! decade_city.js - v0.2.0 - 2013-04-26
* https://github.com/decadecity/decade_city.js
* Copyright (c) 2013 Orde Saunders; Licensed MIT */
window.DECADE_CITY=function(e,t){var n=[],r=!1;e.register=function(e){typeof e=="function"&&(r?e.call():n.push(e))},e.config={},e.init=function(i){t.extend(e.config,i),t.each(n,function(e,t){t.call()}),r=!0};var i=[],s=!1;e.registerLoad=function(e){typeof e=="function"&&(s?e.call():i.push(e))},t(window).load(function(){t.each(i,function(e,t){t.call()}),s=!0});var o=[];e.registerResize=function(e){typeof e=="function"&&o.push(e)};var u=function(){var e;t(window).resize(function(){var n=250;e&&(e=window.clearTimeout(e)),e=window.setTimeout(function(){t.each(o,function(e,t){t.call()})},n)})};return e.register(u),e}(window.DECADE_CITY||{},window.jQuery),window.DECADE_CITY=function(e){"use strict";return e.COOKIES=function(e,t){var n=window.escape,r=window.unescape;return t.getItem=function(e){return!e||!this.hasItem(e)?null:r(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+n(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"))},t.setItem=function(e,t,r,i,s,o){if(!e||/^(?:expires|max\-age|path|domain|secure)$/.test(e))return;var u="";if(r)switch(typeof r){case"number":u="; max-age="+r;break;case"string":u="; expires="+r;break;case"object":r.hasOwnProperty("toGMTString")&&(u=";expires="+r.toGMTString())}document.cookie=n(e)+"="+n(t)+u+(s?";domain="+s:"")+(i?";path="+i:"")+(o?";secure":"")},t.removeItem=function(e){if(!e||!this.hasItem(e))return;document.cookie=n(e)+"=;expires=Thu, 01-Jan-1970 00:00:01 GMT;"},t.hasItem=function(e){return(new RegExp("(?:^|;\\s*)"+n(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie)},t}(e,e.COOKIES||{}),e}(window.DECADE_CITY||{}),window.DECADE_CITY=function(e,t){"use strict";return e.POLYFILL=function(e,t,n){return n.fn.outerHTML=function(){var e;return n(this).length?"outerHTML"in n(this)[0]?n(this)[0].outerHTML:(e=n(this).wrap("<div></div>").parent().html(),n(this).unwrap(),e):""},t.sessionStorage=function(){var e=typeof window.sessionStorage!="undefined",t={};return t.getLength=function(){return e?window.sessionStorage.length:0},t.key=function(t){return e?window.sessionStorage.key(t):null},t.getItem=function(t){return e?window.sessionStorage.getItem(t):null},t.setItem=function(t,n){if(!e)return;try{return window.sessionStorage.setItem(t,n)}catch(r){if(r.name.toLowerCase()==="quota_exceeded_err")return;throw r}},t.removeItem=function(t){if(!e)return;return window.sessionStorage.removeItem(t)},t.clear=function(){if(!e)return;return window.sessionStorage.clear()},t.supported=e,t}(),t}(e,e.POLYFILL||{},t),e}(window.DECADE_CITY||{},window.jQuery),window.DECADE_CITY=function(e){"use strict";return e.SPEED_TEST=function(e,t){var n=!1;return t.test=function(){var t=2.5,r=4,i=0,s=typeof window.performance!="undefined"&&typeof window.performance.timing!="undefined",o=typeof e.POLYFILL!="undefined"&&typeof e.POLYFILL.sessionStorage!="undefined",u=navigator.connection||{type:0},a;if(n)return;e.load_speed="slow",window.t_domready||(window.t_domready=new Date),o&&(a=parseInt(e.POLYFILL.sessionStorage.getItem("load-count"),10),isNaN(a)&&(a=0),e.POLYFILL.sessionStorage.setItem("load-count",a+1)),isNaN(a)&&(a=0),t*=1e3,s?i=window.performance.timing.domInteractive-window.performance.timing.requestStart:window.t_pagestart&&window.t_domready&&(i=window.t_domready-window.t_pagestart+500),o&&e.POLYFILL.sessionStorage.getLength()?(e.load_speed=e.POLYFILL.sessionStorage.getItem("load-speed")||"slow",e.load_speed!=="fast"&&a<r&&i<t&&(e.load_speed="fast")):i<t&&(e.load_speed="fast");switch(u.type){case u.CELL_2G:e.load_speed="slow",e.connection_type="2g";break;case u.CELL_3G:e.load_speed="slow",e.connection_type="3g";break;case u.WIFI:e.connection_type="wifi";break;case u.ETHERNET:e.connection_type="wired";break;default:e.connection_type="unknown"}e.load_speed!=="fast"&&(e.load_speed="slow"),document.getElementsByTagName("html")[0].className+=" "+e.load_speed,o&&e.POLYFILL.sessionStorage.setItem("load-speed",e.load_speed),n=!0},typeof e.register=="function"&&e.register(t.test),t}(e,e.SPEED_TEST||{}),e}(window.DECADE_CITY||{}),window.DECADE_CITY=function(e,t){"use strict";return e.TIMING=function(e,t,n){var r={},i,s=typeof window.performance!="undefined"&&typeof window.performance.timing!="undefined";t.addVar=function(e,t){if(typeof e=="string")r[e]=t;else if(typeof e=="object"){var n=e,i;for(i in n)n.hasOwnProperty(i)&&(r[i]=n[i])}},t.addVar({b_height:n(window).height(),b_width:n(window).width(),noscript:0,r:document.referrer,u:window.location.href});var o=function(){var e=[],t="?",n,s;if(r&&i){i.search(/\?/)>-1&&(t="&");for(n in r)r.hasOwnProperty(n)&&e.push(n+"="+encodeURIComponent(r[n]));s=new Image,s.src=i+t+e.join("&")}},u=function(){var o;e.config.hasOwnProperty("beacon_url")&&(i=e.config.beacon_url),e.config.debug&&(t.getVars=function(){return r}),s||(typeof e.POLYFILL.sessionStorage.supported?e.POLYFILL.sessionStorage.setItem("t_navigation_start",(new Date).getTime()):typeof e.COOKIES!="undefined"&&n(window).on("unload",function(){e.COOKIES.setItem("t_navigation_start",(new Date).getTime(),!1,"/")})),s&&(window.t_pagestart=window.performance.timing.responseEnd),window.t_domready||n(document).ready(function(){s?window.t_domready=window.performance.timing.domInteractive:window.t_domready=(new Date).getTime()})};e.register(u);var a=function(){var n=window.t_onload||new Date,r,i,u;s?(n=window.performance.timing.loadEventStart,i=window.performance.timing.domInteractive-window.performance.timing.navigationStart,u=n-window.t_pagestart):(typeof e.POLYFILL.sessionStorage.supported?r=e.POLYFILL.sessionStorage.getItem("t_navigation_start"):typeof e.COOKIES!="undefined"&&(r=e.COOKIES.getItem("t_navigation_start")),r&&(i=window.t_domready-r),window.t_pagestart&&(u=n-window.t_pagestart)),window.t_pagestart&&window.t_domready&&(t.addVar("t_domready",window.t_domready-window.t_pagestart),window.t_headend&&(t.addVar("t_head",window.t_headend-window.t_pagestart),window.t_bodyend&&t.addVar("t_body",window.t_bodyend-window.t_headend))),i&&t.addVar("t_done",i),u&&t.addVar("t_onload",u),window.t_jsstart&&window.t_jsend&&t.addVar("t_js",window.t_jsend-window.t_jsstart),window.setTimeout(o,500)};return e.registerLoad(function(){window.t_onload=new Date,window.setTimeout(a,500)}),t}(e,e.TIMING||{},t),e}(window.DECADE_CITY||{},window.jQuery),window.DECADE_CITY=function(e,t){"use strict";return e.PROFILE=function(e,t,n){var r=new Image,i=n("html"),s,o;s=function(){t.profile.json&&typeof e.COOKIES!="undefined"&&e.COOKIES.setItem("profile",JSON.stringify(t.profile),null,"/")},t.profile=t.profile||{},t.profile.profile=!0,t.profile.svg=!1,!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")||(t.profile.svg=!0),e.transform_prefix="","webkitTransform"in r.style?(e.transform_prefix="-webkit-",t.profile.transform=!0):"MozTransform"in r.style?(e.transform_prefix="-moz-",t.profile.transform=!0):"OTransform"in r.style?(e.transform_prefix="-o-",t.profile.transform=!0):"transform"in r.style&&(e.transform_prefix="",t.profile.transform=!0),t.profile.transform&&i.addClass("transform");if("ontouchstart"in window||typeof navigator.msMaxTouchPoints!="undefined"&&navigator.msMaxTouchPoints>0)t.profile.touch=!0,n(i).hasClass("pointer")&&n(i).removeClass("pointer");return typeof JSON!="undefined"&&(t.profile.json=!0),o=document.createElement("script"),o.setAttribute("async",!0),t.profile.async_scripts=!!o.async,t.profile.timing=typeof window.performance!="undefined"&&typeof window.performance.timing!="undefined",t.sendProfile=function(r){if(typeof e.COOKIES=="undefined")return!1;n(document).ready(function(){window.setTimeout(function(){var i=!1,o=e.config.profiler_url||"/profile";typeof e.load_speed!="undefined"&&(t.profile.load_speed=e.load_speed),typeof e.connection_type!="undefined"&&(t.profile.connection_type=e.connection_type),typeof e.POLYFILL.sessionStorage!="undefined"&&(t.profile.session_storage=e.POLYFILL.sessionStorage.supported),s(),t.profile.session_storage?i=!!e.POLYFILL.sessionStorage.getItem("profile-sent"):i=!!e.COOKIES.getItem("profile-sent");if(!i||r)n.get(o,t.profile),t.profile.session_storage?e.POLYFILL.sessionStorage.setItem("profile-sent",1):e.COOKIES.setItem("profile-sent",1,null,"/")},100)})},e.register(t.sendProfile),e.register(s),t}(e,e.PROFILE||{},t),e}(window.DECADE_CITY||{},window.jQuery),window.DECADE_CITY=function(e,t){"use strict";return e.IMAGES=function(e,t,n){t._svgSrc=function(e){return e.replace(/\.[^.\?]*($|\?)/,".svg$1")};var r=function(){e.PROFILE.svg&&n(".svg-replace").each(function(){n(this).attr("src",function(e,n){return t._svgSrc(n)}),n(this).removeClass("svg-replace")})};return e.register(r),t}(e,e.IMAGES||{},t),e}(window.DECADE_CITY||{},window.jQuery),window.DECADE_CITY=function(e,t){"use strict";return e.FLICKR=function(e,t,n){var r=/^http(s)?:\/\/(.*)\.staticflickr.com\/(.*?)(_.\.jpg|\.jpg)$/,i,s,o,u,a="_m",f=!1;return i=function(e){return e=parseInt(e,10),isNaN(e)&&(e=0),e},o=function(e){var t,n;return t=r.exec(e),t?(n=t[1]||"","http"+n+"://"+t[2]+".staticflickr.com/"+t[3]+a+".jpg"):e},s=function(){var e=n("img.responsive");if(e.length){var t,r;t=n('<div id="flickr-image-holder"/>').css({height:"1px",width:"1px"}).fadeTo(1,.1).appendTo("body"),r=function(){t.find("img").length===0&&t.remove()},e.each(function(){var e=n(this),i=e.attr("src"),s=o(i),u;if(i===s)return i;u=n('<img src="'+s+'" alt="" height="1" width="1">'),t.append(u),u.on("load",function(){e.attr("src",s),u.remove(),r()})}),r()}},u=function(t,r,o,u){var l;e.SPEED_TEST.test(),typeof e.load_speed!="undefined"&&typeof u=="undefined"&&(u=e.load_speed),f||(t=t||n(window).width(),r=r||n(window).height(),o=o||i(window.devicePixelRatio)||1,l=Math.max(t,r),l*=o,l=i(l),u!=="fast"&&(u="slow"),l<280||u==="slow"?a="_m":l<320?a="_n":l<500?a="":l<640?a="_z":l<800?a="_c":a="_b",typeof e.PROFILE.profile=="object"&&(e.PROFILE.profile.flickr_suffix=a),typeof e.COOKIES!="undefined"&&e.COOKIES.setItem("flickr_suffix",a,null,"/"),f=!0),s()},e.register(u),e.register(function(){e.config.debug&&(t.init=u,t.imageSrc=o,t.flickr_suffix=function(e){if(typeof e=="undefined")return a;a=e},t.flickr_suffix_set=function(e){if(typeof e=="undefined")return f;f=!!e})}),t}(e,e.FLICKR||{},t),e}(window.DECADE_CITY||{},window.jQuery);